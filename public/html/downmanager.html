<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title></title>
  <!--<link rel="stylesheet" href="../css/normalize.css">-->
  <link rel="stylesheet" href="../css/styles.css" media="screen" type="text/css" />
  <link rel="stylesheet" href="../css/bootstrap.css" media="screen" type="text/css" />
  <script src="../js/jquery.js"></script>
  <script src="../js/jquery.cookie.js"></script>
  <link href="../css/qikoo.css" rel="stylesheet" type="text/css"/>
  <script src="../js/qikoo.js"></script>

  <style>
    .tabBlock-pane li{
      list-style-type: none;
    }
  </style>
  <style>
    a:hover,a:active{
      color: red;
    }
    .tabBlock-content {
        background-color: #333333;
        border: 0px ;
      }
    .progress{
      height: 8px;
      background: #262626;
      padding: 1px;
      overflow: visible;
      border-radius: 20px;
      border-top: 1px solid #000;
      border-bottom: 1px solid #7992a8;
      margin: 1px;
    }
    /*.content-name{*/
      /*font-family:'PingFangSC-Regular',"-apple-system","microsoft yahei";*/
      /*font-size: 10px;*/
    /*}*/
    .progress .progress-bar{
      border-radius: 20px;
      position: relative;
      animation: animate-positive 2s;
    }
    .progress .progress-value{
      display: block;
      padding: 3px 7px;
      font-size: 13px;
      color: #fff;
      border-radius: 4px;
      background: #191919;
      border: 1px solid #000;
      position: absolute;
      top: -40px;
      right: -10px;
    }
    .progress .progress-value:after{
      content: "";
      border-top: 10px solid #191919;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      position: absolute;
      bottom: -6px;
      left: 26%;
    }
    .progress-bar.active{
      animation: reverse progress-bar-stripes 0.40s linear infinite, animate-positive 2s;
    }
    @-webkit-keyframes animate-positive{
      0% { width: 0; }
    }
    @keyframes animate-positive{
      0% { width: 0; }
    }
  </style>
  <style>
    .div-center{
      float: left;
    }

  </style>
  <style>
    .test-1::-webkit-scrollbar {/*滚动条整体样式*/
      width: 10px;     /*高宽分别对应横竖滚动条的尺寸*/
      height: 1px;
    }
    .test-1::-webkit-scrollbar-thumb {/*滚动条里面小方块*/
      border-radius: 10px;
      -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
      background: #4E4E4E;
      /*background: #535353;*/
    }
    .test-1::-webkit-scrollbar-track {/*滚动条里面轨道*/
      -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
      border-radius: 10px;
      background: #000000;
      /*background: #EDEDED;*/
    }

    .line-limit-length {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap; //文本不换行，这样超出一行的部分被截取，显示...
    }
  </style>

  <!--<style type="text/css">-->
    <!--input[type="checkbox"] {-->
      <!--width: 12px;-->
      <!--height: 12px;-->
      <!--display: inline-block;-->
      <!--text-align: center;-->
      <!--vertical-align: middle;-->
      <!--line-height: 12px;-->
      <!--position: relative;-->
    <!--}-->

    <!--input[type="checkbox"]::before {-->
      <!--content: "";-->
      <!--position: absolute;-->
      <!--top: 0;-->
      <!--left: 0;-->
      <!--background: #fff;-->
      <!--width: 100%;-->
      <!--height: 100%;-->
      <!--border: 1px solid #CACDCF-->
    <!--}-->

    <!--input[type="checkbox"]:checked::before {-->
      <!--content: "\2713";-->
      <!--background-color: #2196F3;-->
      <!--color: #fff;-->
      <!--position: absolute;-->
      <!--top: 0;-->
      <!--left: 0;-->
      <!--width: 100%;-->
      <!--border: 1px solid #2196F3;-->
      <!--font-size: 12px;-->
      <!--font-weight: bold;-->
    <!--}-->
  <!--</style>-->
</head>
<body >
  <figure class="tabBlock" style="width: 650px;">
  <ul class="tabBlock-tabs">
    <li class="tabBlock-tab is-active">下载中(<span id="download_num">0</span>)</li>
    <li class="tabBlock-tab">已下载(<span id="downloaded_num">0</span>)</li>
  </ul>
  <div class="tabBlock-content" style="width: auto;">
    <div class="tabBlock-pane">
      <ul id="list">
        <div style="overflow-y: auto;height: 250px;" class="test-1">
          <div id="mybox">
            <!--<li >-->
              <!--<div style="width: 600px;">-->
                <!--<div style="float: left">-->
                  <!--<input class="mychk" name="mychk" type="checkbox" value="123456" onclick="checkboxOnclick(this)"/><img style="width: 50px;height: 50px;" src="../images/test.jpg">-->
                <!--</div>-->
                <!--<div style="float: left;width: 400px;">-->
                  <!--<p style="display: inline-block;color: #CCCCCC">节目名称1</p>-->
                  <!--<div class="div_parent" style="display: inline-block;float: right;margin-right: 20px;">-->
                    <!--<img class="single_pause_img" onclick="singlePause(this)" style="width: 20px;height: 20px;vertical-align: center" src="../images/ic_l_download_d.png">&nbsp;&nbsp;-->
                    <!--<span class="pause_down_span" style="color: #CCCCCC">下载</span>-->
                  <!--</div>-->

                  <!--<div class="progress">-->
                    <!--<div class="progress-bar progress-bar-success progress-bar-striped active" style="width: 10%;">-->
                    <!--</div>-->
                  <!--</div>-->

                  <!--<div style="color:#CCCCCC;" class="mark">-->
                    <!--<span  class="pause_span"></span>-->
                    <!--<span class="file_size_before">1000M/</span>-->
                    <!--<span class="file_size_after">5000M</span>-->
                  <!--</div>-->
                <!--</div>-->

                <!--<div style="float: left;margin-top: 20px;margin-left: 8px;">-->
                  <!--<span style="margin-top3:3px;color: #CCCCCC;">10%</span>-->
                  <!--<img class="callConfirm" src="../images/ic_delete.png" style="width: 22px;height: 22px;"/>-->
                <!--</div>-->
              <!--</div>-->
            <!--</li>-->

            <!--<li>-->
              <!--<div>-->
                <!--<div style="float: left">-->
                  <!--<input class="mychk" name="mychk" type="checkbox" value="123456" onclick="checkboxOnclick(this)"/><img style="width: 50px;height: 50px;" src="../images/test.jpg">-->
                <!--</div>-->
                <!--<div style="float: left;width: 400px;">-->
                  <!--<p style="display: inline-block;color: #CCCCCC">节目名称1</p>-->
                  <!--<div class="div_parent" style="display: inline-block;float: right;margin-right: 20px;">-->
                    <!--<img class="single_pause_img" onclick="singlePause(this)" style="width: 20px;height: 20px;vertical-align: center" src="../images/ic_l_download_d.png">&nbsp;&nbsp;-->
                    <!--<span class="pause_down_span" style="color: #CCCCCC">下载</span>-->
                  <!--</div>-->

                  <!--<div class="progress">-->
                    <!--<div class="progress-bar progress-bar-success progress-bar-striped active" style="width: 10%;">-->
                    <!--</div>-->
                  <!--</div>-->

                  <!--<div style="color:#CCCCCC;" class="mark">-->
                    <!--<span class="pause_span"></span>-->
                    <!--<span class="file_size_before">1000M/</span>-->
                    <!--<span class="file_size_after">5000M</span>-->
                  <!--</div>-->
                </div>

                <!--<div style="float: left;margin-top: 20px;margin-left: 8px;">-->
                  <!--<span style="margin-top3:3px;color: #CCCCCC;">10%</span>-->
                  <!--<img class="callConfirm" src="../images/ic_delete.png" style="width: 22px;height: 22px;"/>-->
                <!--</div>-->
              <!--</div>-->
            <!--</li>-->
          <!--</div>-->
          <!--<div id="box" style="height: 100px;overflow:auto;border: 1px solid #252525;" class="test-1">-->
          <!--</div>-->

        </div>
        <div class="start-stop-div" style="background-color: #181818;filter:alpha(Opacity=80);-moz-opacity:0.1;opacity: 0.1;">
          <div>
            <label style="color:red;"><input style="margin-left: 13px;margin-top:11px;" type="checkbox" id="all" onclick="chk()"></label>
            <img id="bottom_start" onclick="bottom_start()" src="../images/ic_start_d.png"><span id="bottom_start_span">开始</span>
            <!--<img id="bottom_pause" onclick="bottom_pause()" src="../img/ic_pause_d.png"><span id="bottom_start_pause">暂停</span>-->
            <img id="bottom_delete" onclick="bottom_delete()" src="../images/ic_delete_d.png"/><span id="bottom_start_delete">删除</span>
          </div>
        </div>
      </ul>
    </div>
    <div class="tabBlock-pane">
      <ul>
        <div style="overflow-y: auto;height: 250px;" class="test-1">
          <li>
            <div style="height: 60px;line-height: 20px;">
              <div style="float: left;">
                <img style="width: 50px;height: 50px;" src="../images/test.jpg">
              </div>
              <div>
              <div style="float: left;width: 520px;height: 50px;">
                <div style="height: 27px;">
                  <p style="display: inline-block;color: #CCCCCC">节目名称1</p>
                  <div class="div_parent" style="display: inline-block;float: right;margin-right: 20px;">
                    <img class="single_pause_img" onclick="finishPlay(this)" style="width: 20px;height: 20px;vertical-align: center" src="../images/play.png">&nbsp;&nbsp;
                    <span class="pause_down_span" style="color: #CCCCCC">播放</span>
                  </div>
                </div>
                  <div style="float: bottom;color:#CCCCCC;"><p class="line-limit-length">节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述</p></div>
                </div>
              </div>

              <div style="float: left;margin-top: 10px;margin-left: 8px;">
                <img class="callConfirm" src="../images/ic_delete.png" style="width: 22px;height: 22px;"/>
              </div>
            </div>
          </li>
          <li>
            <div style="height: 60px;line-height: 20px;">
              <div style="float: left;">
                <img style="width: 50px;height: 50px;" src="../images/test.jpg">
              </div>
              <div>
                <div style="float: left;width: 520px;height: 50px;">
                  <div style="height: 27px;">
                    <p style="display: inline-block;color: #CCCCCC">节目名称1</p>
                    <div class="div_parent" style="display: inline-block;float: right;margin-right: 20px;">
                      <img class="single_pause_img" onclick="finishPlay(this)" style="width: 20px;height: 20px;vertical-align: center" src="../images/play.png">&nbsp;&nbsp;
                      <span class="pause_down_span" style="color: #CCCCCC">播放</span>
                    </div>
                  </div>
                  <div style="float: bottom;color:#CCCCCC;"><p class="line-limit-length">节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述节目描述</p></div>
                </div>
              </div>

              <div style="float: left;margin-top: 10px;margin-left: 8px;">
                <img class="callConfirm" src="../images/ic_delete.png" style="width: 22px;height: 22px;"/>
              </div>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <!-- 底部 所有任务下载关机按钮，文件存储按钮，设置按钮 start-->
    <div style="width: auto;height: 50px;margin-top: 5px;">
      <div class="auto-shutdown-div" style="float: left"><img id="image" onclick="changeImage()" src="../images/ic_sw_off.png"/><span style="color: #007AFF;">所有任务下载后自动关机</span></div>
      <div style="float: right"><img onclick="openDir()" src="../images/ic_store.png"/><img onclick="openSettings()" src="../images/ic_setting.png"/></div>
    </div>
    <!-- 底部 所有任务下载关机按钮，文件存储按钮，设置按钮 end-->
  </div>

</figure>
<script>
  //鼠标停留 文字变色(单个节目 暂停  下载)
  $(".single_pause_span").mouseover(function(){
    $(this).css({
//      "border-color":"yellow",
      "color": "#007AFF"
    });
  }).mouseout(function(){
    $(this).css({
//      "border-color":"",
      "color": "#CCCCCC "
    });
  });

  //点击单个节目暂停(停止下载)
  function singlePause(that){
    if($(that).attr('src').match("ic_l_download_d")){
      $(that).attr('src','../images/ic_l_pause_d.png');
//      $(that).parent('.div_parent').siblings('.mark').find('.texts').slideUp(0).siblings('.pause_span').slideDown(0);
      $(that).parent('.div_parent').siblings('.mark').find('.pause_span').text("暂停");
      $(that).parent('.div_parent').siblings('.mark').find('.file_size_before').hide();
      $(that).parent('.div_parent').siblings('.mark').find('.file_size_after').hide();
      $(that).siblings('.pause_down_span').text("暂停")

    } else {
      $(that).attr('src','../images/ic_l_download_d.png');
//      $(that).parent('.div_parent').siblings('.mark').find('.texts').slideDown(0).siblings('.pause_span').slideUp(0);
      $(that).parent('.div_parent').siblings('.mark').find('.pause_span').text("");
      $(that).parent('.div_parent').siblings('.mark').find('.file_size_before').show();
      $(that).parent('.div_parent').siblings('.mark').find('.file_size_after').show();
      $(that).siblings('.pause_down_span').text("下载")
    }
  }
    //点击删除
    $(".callConfirm").click(function(){
      qikoo.dialog.confirm('你确定要删除下载任务吗?\t删除将无法恢复。',function(){
       //TODO
      },function(){
      });
    });

  //点击底部全选开始按钮(暂停按钮)
  function bottom_start(){
    //点击开始，校验checkbox是否为空
    var check_list = ($("input[type='checkbox']:checked").length);
    if (check_list<=0) {
      alert("您还没有选择节目，请选择节目");
      return false
    }
    var element = document.getElementById('bottom_start');
    if (element.src.match("ic_start_d")) {//取消下载
      element.src="../images/ic_pause_d.png";
//      document.getElementById("bottom_start_span").style.color="#FFFFFF";
      $("#bottom_start_span").text("暂停");
    } else {//点击下载
      element.src="../images/ic_start_d.png";
//      document.getElementById("bottom_start_span").style.color="#007AFF";
      $("#bottom_start_span").text("开始");

      var obj = document.getElementsByName("mychk");
      var check_val = [];
      for(k in obj){
        if(obj[k].checked)
          check_val.push(obj[k].value);
      }
      var check_vals = check_val.join(",");
      console.log("chebox选择的节目进行开始下载->"+check_vals);
      //TODO 根据上面的节目id进行开始下载
    }
  }

</script>
  <script>
    function chk(){
      var all = document.getElementById("all");
      var mychk = document.getElementsByName("mychk");
      //alert("mychk长度=="+mychk.length);
      if(all.checked == true){
        //alert("all.checked==true全选");
        if(mychk.length){
          for(var i=0;i<mychk.length;i++){
            mychk[i].checked = true;
          }
        }
        mychk.chcked=true;
      }else{
        //alert("all.checked==false全不选");
        if(mychk.length){
          for(var i=0;i<mychk.length;i++){
            mychk[i].checked = false;
          }
        }
      }
    }

    //点击checkbox
    function checkboxOnclick(checkbox){
      if ( checkbox.checked == true){
        var check_list = ($("input[type='checkbox']:checked").length);
//        document.getElementsByName("mychk").style.css("background","url(../img/ic_more_a.png) left center no-repeat");
      }else{
        var check_list = ($("input[type='checkbox']:checked").length);
//        document.getElementsByName("mychk").style.css("background","url(../img/ic_more_n.png) left center no-repeat");
      }
      //alert(check_list)
      //$("#select_nums").html("共选择"+check_list+"个文件");
    }

    $(document).ready(function(){
      var flag = 1;
      $(".mychk").click(function(){
        if(flag == 1){
          $(".mychk").css("background","url(../images/ic_more_a.png) left center no-repeat");
          flag = 0;
        } else{
          $(".mychk").css("background","url(../images/ic_more_n.png) left center no-repeat");
          flag = 1;
        }
      })
    });

    //点击 底部 左下角 按钮【所有任务下载后自动关机】
    function changeImage(){
      //判断 用户是否选择节目，如果没有选择节目提示用户选择节目
      var check_list = ($("input[type='checkbox']:checked").length);
      if (check_list<=0) {
        alert("您还没有选择节目，请选择节目");
        return false
      }
      var element=document.getElementById('image');
      if (element.src.match("ic_sw_on")) {
        element.src="../images/ic_sw_off.png";
        //TODO 需要调用系统的关机命令，用户下载完所有的视频，制动关机
      }
      else {
        element.src="../images/ic_sw_on.png";
        //TODO 需要调用解除系统关机命令，如果用户点击了上面开关，然后关掉，此处要解除关机
      }
    }
    //点击 底部 右下角 文件存储 按钮
    function openDir(){
      //TODO
      alert("需要实现，打开文件路径")
    }
    //点击 底部 右下角 设置按钮
    function openSettings(){
      //TODO
      alert("需要实现 打开设置面板")
    }

    //已下载中 点击 播放
    function finishPlay(){
      alert("需要调用播放器进行播放");
      //TODO 调用本地播放器进行播放
    }
    //底部删除
    function bottom_delete(){

    }
</script>
<script>
  $(function(){
    var receiveData = localStorage.getItem('selectData');//得到用户选择数据
    var receiveDownloadData = localStorage.getItem('downloadData');
//    var para= $.cookie("cc");
    var d = $.parseJSON(receiveData);
    var html="";
    if (d == null){
      html="<div style='text-align: center;;color: #666666'><p style='display: block;line-height: 240px'>点击右上角新建下载</p></div>";
      $('#mybox').html(html);
      $(".auto-shutdown-div").css('display','none');
      $(".start-stop-div").css('display','none');

    }else{
      var content_width="";
      $("#download_num").text(d.length);
      console.log("用户选择了"+ d.length+"集");
      if(d.length <=3){
        content_width="480px";
      }else{
        content_width="470px";
      }
      //解析下载地址数据
      var download_datas = $.parseJSON(receiveDownloadData);

      for(var i in d){
        downdata = JSON.parse(d[i]);
        for (x in download_datas){
          if (i == x){
            //console.log("url->"+download_datas[x].url+"mediaSize->"+download_datas[x].mediaSize)
            downdata.mediaSize = parseInt(download_datas[x].mediaSize/1024/2014);
            downdata.url = download_datas[x].url;
          }
        }
//      console.log(d[i].length);
        console.log(downdata.cid,downdata.newName,downdata.imgH,downdata.detail,downdata.timeLong,downdata.uc);
        //动态添加下载中列表)
        html +='<li><div><div style="float: left"><input class="mychk" name="mychk" type="checkbox" value="'+downdata.cid+'" onclick="checkboxOnclick(this)"/><img style="width: 50px;height: 50px;" src="'+downdata.imgH+'"></div>'+
                '<div style="float: left;width: '+content_width+';">'+
                '<p class="content-name" style="display: inline-block;color: #CCCCCC">'+downdata.newName+'</p>'+
                '<div class="div_parent" style="display: inline-block;float: right;margin-right: 20px;">'+
                '<img class="single_pause_img" onclick="singlePause(this)" style="width: 20px;height: 20px;vertical-align: center" src="../images/ic_l_download_d.png">&nbsp;&nbsp;'+
                '<span class="pause_down_span" style="color: #CCCCCC">下载</span>'+
                '</div>'+
                '<div class="progress">'+
                '<div class="progress-bar progress-bar-success progress-bar-striped active" style="width: 20%;">'+
                '</div>'+
                '</div>'+
                '<div style="color:#CCCCCC;" class="mark">'+
                '<span  class="pause_span"></span>'+
                '<span class="file_size_before">1000M/</span>'+
                '<span class="file_size_after">'+downdata.mediaSize+'M</span>'+
                '</div>'+
                '</div>'+
                '<div style="float: left;margin-top: 20px;margin-left: 4px;">'+
                '<span style="margin-top:3px;color: #CCCCCC;">20%</span>'+
                '<img class="callConfirm" src="../images/ic_delete.png" style="width: 22px;height: 22px;"/>'+
                '</div>'+
                '</div>'+
                '</li>';
        $('#mybox').html(html);
      }
    }

  });
</script>
<!--<script src='../js/jquery.js'></script>-->
<script src="../js/downmanger.js"></script>
</body>
</html>